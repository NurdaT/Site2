<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∞—Ç-–±–æ—Ç</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div id="chat-container">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ß–∞—Ç-–±–æ—Ç—É.</h1>
        <div id="chat-box"></div>

        <div id="input-container">
            <input type="text" id="user-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å...">

            <button onclick="sendMessage('local')">üìã</button>
            <button onclick="sendMessage('ai')">ü§ñ</button>
            <button id="voice-btn">üé§</button>
        </div>
    </div>

    <audio id="bot-audio" style="display:none;" controls></audio>

<script>
    async function sendMessage(mode) {
        let userInput = document.getElementById("user-input").value;
        let chatBox = document.getElementById("chat-box");

        if (userInput.trim() === "") return;

        chatBox.innerHTML += `<div class="message user-message"><p>${userInput}</p></div>`;
        document.getElementById("user-input").value = "";

        let response = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                message: userInput,
                mode: mode // 'local' –∏–ª–∏ 'ai'
            })
        });

        let data = await response.json();

        chatBox.innerHTML += `<div class="message bot-message"><p>${data.response}</p></div>`;

        let audio = document.getElementById("bot-audio");
        audio.src = data.audio;
        audio.play();

        chatBox.scrollTop = chatBox.scrollHeight;
    }

    document.getElementById("voice-btn").addEventListener("click", () => {
        let recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = "ru-RU";
        recognition.start();
        recognition.onresult = (event) => {
            let voiceText = event.results[0][0].transcript;
            document.getElementById("user-input").value = voiceText;
        };
    });
</script>
</body>
</html>
